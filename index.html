<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invito Battesimo Emma</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css?family=Great+Vibes|Lora:400,700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Loading Animation -->
    <div id="loading-screen" class="loading-container">
        <div class="envelope">
            <div class="envelope-back"></div>
            <div class="envelope-front">
                <div class="envelope-flap"></div>
            </div>
            <div class="letter">
                <div class="letter-content">
                    <div class="letter-header">Emma</div>
                    <div class="letter-lines">
                        <div class="line"></div>
                        <div class="line"></div>
                        <div class="line"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="loading-text">Aprendo l'invito...</div>
    </div>

    <!-- Main Content -->
    <div id="main-content" class="invito-bg" style="display: none;">
        <div class="invito-container">
            <h1 class="titolo-emma">Emma</h1>
            <div class="sottotitolo">è felice di invitarti al suo</div>
            <div class="titolo-evento">Santo Battesimo</div>
            <div class="immagine-arco">
                <img src="emma-battesimo.jpeg" alt="Emma battesimo">
            </div>
            <div class="dettagli">
                <div class="data-ora">
                    <a href="data:text/calendar;charset=utf8,BEGIN:VCALENDAR%0AVERSION:2.0%0APRODID:-//Test//Test//EN%0ABEGIN:VEVENT%0AUID:santo-battesimo-emma@example.com%0ADTSTAMP:20250721T120000Z%0ADTSTART:20250921T090000Z%0ADTEND:20250921T110000Z%0ASUMMARY:Santo Battesimo Emma%0ADESCRIPTION:A seguire pranzo presso Circolo NOI Andrea Milani%0ALOCATION:Chiesa SS. Fermo e Rustico\, Colognola ai Colli%0AEND:VEVENT%0AEND:VCALENDAR" download="santo-battesimo-emma.ics">
                        21 Settembre 2025 | ore 11:00
                    </a>
                </div>
                <div class="luogo">
                    <a href="https://maps.google.com/?q=Chiesa+SS.+Fermo+e+Rustico,+Colognola+ai+Colli,+Italy" target="_blank">
                        Chiesa SS. Fermo e Rustico
                    </a><br>
                    <a href="https://maps.google.com/?q=Circolo+NOI+Andrea+Milani,+Colognola+ai+Colli,+Italy" target="_blank">
                        Circolo NOI Andrea Milani
                    </a>
                </div>
            </div>
            <div class="nota-finale">A seguire pranzo presso Circolo NOI Andrea Milani</div>
            <div class="parteciperai">
                <h2>Parteciperai?</h2>
                <button onclick="sendWhatsAppResponse('yes')">Sì</button>
                <button onclick="sendWhatsAppResponse('no')">No</button>
            </div>
        </div>
    </div>

    <script>
        // Configuration - Replace with your actual Lambda API endpoint
        const LAMBDA_API_ENDPOINT = 'https://4sl8y10tm8.execute-api.eu-north-1.amazonaws.com/prod/whatsapp';
        
        // Loading animation
        window.addEventListener('load', function() {
            setTimeout(function() {
                const loadingScreen = document.getElementById('loading-screen');
                const mainContent = document.getElementById('main-content');
                
                loadingScreen.style.opacity = '0';
                loadingScreen.style.transition = 'opacity 0.5s ease-out';
                
                setTimeout(function() {
                    loadingScreen.style.display = 'none';
                    mainContent.style.display = 'flex';
                    mainContent.style.opacity = '0';
                    mainContent.style.transition = 'opacity 0.5s ease-in';
                    
                    setTimeout(function() {
                        mainContent.style.opacity = '1';
                    }, 50);
                }, 500);
            }, 3000); // Show loading for 3 seconds
        });
        
        // Function to handle WhatsApp responses
        async function sendWhatsAppResponse(action) {
            try {
                // Show loading state
                const button = event.target;
                const originalText = button.textContent;
                button.textContent = 'Caricamento...';
                button.disabled = true;
                
                // Call Lambda function
                const response = await fetch(`${LAMBDA_API_ENDPOINT}?action=${action}`);
                
                if (!response.ok) {
                    throw new Error('Errore nel server');
                }
                
                const data = await response.json();
                
                // Open WhatsApp with the URL from Lambda
                window.open(data.whatsappUrl, '_blank');
                
                // Reset button
                button.textContent = originalText;
                button.disabled = false;
                
            } catch (error) {
                console.error('Errore:', error);
                
                // Fallback to direct WhatsApp (without phone number)
                alert('Si è verificato un errore. Verrai reindirizzato a WhatsApp dove potrai inserire manualmente il numero.');
                window.open('https://wa.me/', '_blank');
                
                // Reset button
                const button = event.target;
                button.textContent = button.textContent.replace('Caricamento...', originalText);
                button.disabled = false;
            }
        }
    </script>
</body>
</html>